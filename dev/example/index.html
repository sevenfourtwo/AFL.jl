<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example · AFL.jl</title><link rel="canonical" href="https://sevenfourtwo.github.io/AFL.jl/example/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">AFL.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Example</a></li><li><a class="tocitem" href="../internals/">Internals</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sevenfourtwo/AFL.jl/blob/master/docs/src/example.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h1><p>To use this package to instrument a program it needs te be compiled with the <code>afl-gcc</code> or <code>afl-clang</code> program which is part of AFL and can be installed on most Linux systems from the package manager (<code>afl++</code> on Ubuntu, <code>american-fuzzy-lop</code> on Fedora). The binary <code>AFL_jll</code> package does also ship a precompiled <code>afl-gcc</code>, its path can be retrieved in Julia as <code>AFL_jll.afl_gcc_exe_path</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p><code>AFL_jll</code> is based on <a href="https://github.com/AFLplusplus/AFLplusplus">AFL++</a>, but <code>AFL.jl</code> can handle both programs instrumented with the original AFL tools as well as the AFL++ tools.</p></div></div><p>Load the required packages (AFL_jll is a binary dependecy of AFL.jl, here it is explicitly required to access to test program):</p><pre><code class="language-julia-repl">julia&gt; using AFL, AFL_jll
ERROR: ArgumentError: Package AFL_jll not found in current path:
- Run `import Pkg; Pkg.add(&quot;AFL_jll&quot;)` to install the AFL_jll package.</code></pre><p>For this example the AFL test program (<a href="https://github.com/AFLplusplus/AFLplusplus/blob/2.68c/test-instr.c">source</a>) is used, a compiled version is shipped with the AFL_jll package. The target can be started from the Julia REPL:</p><pre><code class="language-julia-repl">julia&gt; target = init_target(AFL_jll.afl_test_instr_exe_path);
ERROR: UndefVarError: AFL_jll not defined</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The test program does only work correctly on <code>i686</code> and <code>x86_64</code> systems.</p></div></div><p>We have created a <a href="../internals/#Forkserver">forkserver</a> instance for our target. The forkserver is actually the target binary but it is still running the AFL trampoline code and waiting for a command. When this command is given the target will fork itself and the child will become the actual target. Communication with the forkserver and the actual target is implemented in this package.</p><p>Running the target with only zero bytes as input results in a clean execution as can be seen in the following example:</p><pre><code class="language-julia-repl">julia&gt; run_target(target, b&quot;0&quot;)
ERROR: UndefVarError: target not defined</code></pre><p>Using the instrumentation tools we can see that several branches were covered with this input (the <code>classify_coverage</code> function convert the trace bit from the execution to a coverage map and the <code>coverage_stats</code> function returns the ratio of edges and classes covered by this input). The meaning of the edge classes can be found in the <a href="../internals/#Coverage">coverage</a> section.</p><pre><code class="language-julia-repl">julia&gt; coverage = classify_coverage(target);
ERROR: UndefVarError: target not defined

julia&gt; coverage_stats(coverage)
ERROR: UndefVarError: coverage not defined

julia&gt; [i =&gt; class for (i, class) in enumerate(coverage.edges) if class &gt; 0]
ERROR: UndefVarError: coverage not defined</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The edge numbers are randomly generated every time the target program is compilated. Make sure you only compare those values in runs of the exact same target program.</p></div></div><p>By changing to input we can see the code takes some more branches, covering more code.</p><pre><code class="language-julia-repl">julia&gt; run_target(target, b&quot;12345678&quot;)
ERROR: UndefVarError: target not defined

julia&gt; coverage = classify_coverage(target);
ERROR: UndefVarError: target not defined

julia&gt; coverage_stats(coverage)
ERROR: UndefVarError: coverage not defined

julia&gt; [i =&gt; class for (i, class) in enumerate(coverage.edges) if class &gt; 0]
ERROR: UndefVarError: coverage not defined</code></pre><p>When finished close the connection with the forkserver with:</p><pre><code class="language-julia-repl">julia&gt; close(target)
ERROR: UndefVarError: target not defined</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../internals/">Internals »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 21 November 2020 17:00">Saturday 21 November 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
